{
  "hash": "08fbe6592bcff04d40c93349262c526b",
  "result": {
    "markdown": "---\ntitle: \"In-class Exercise 8 - Network\"\nauthor: \"Li Jiayi\"\ndate: \"03/16/24\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  freeze: true\n  warning: false\n  message: false\ncode-fold: false\ncode-summary: \"Show the code\"\neditor: visual\ndate-format: long\n---\n\n\n## Load the Package\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(igraph, tidygraph, ggraph, \n               visNetwork, lubridate, clock,\n               tidyverse, graphlayouts)\n```\n:::\n\n\n## Import Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_nodes <- read_csv(\"data/GAStech_email_node.csv\")\nGAStech_edges <- read_csv(\"data/GAStech_email_edge-v2.csv\")\n```\n:::\n\n\n`GAStech_nodes` in the node form, 54 roles, and 4 columns\n\n`GAStech_edge` have the sourcelabel in additional to label\n\n## Data preparation\n\nthe code below create 2 new column into the dataframe\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges <- GAStech_edges %>%\n  mutate(SendDate = dmy(SentDate)) %>%\n  mutate(Weekday = wday(SentDate,\n                        label = TRUE,\n                        abbr = FALSE))\n```\n:::\n\n\n::: callout-note\n## Note\n\n-   dmy from lubridate convert character field SentDate into a date column with the format of day, month, year\n\n-   abbr is one of the function in wday, when TRUE, it is MON\n:::\n\nthe code chunk below aggregate the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_edges_aggregated <- GAStech_edges %>%\n  filter(MainSubject == \"Work related\") %>%\n  group_by(source, target, Weekday) %>%\n    summarise(Weight = n()) %>%\n  filter(source!=target) %>%\n  filter(Weight > 1) %>%\n  ungroup()\n```\n:::\n\n\n::: callout-note\n## Insight\n\n`filter(MainSubject == \"Work related\")` used to select only work related, take note `==` is used instead of `=`\n\n`group_by(source, target, Weekday)` allows for aggregation by `source, target, Weekday`\n\n`summarise(Weight = n())` gives the aggregated number\n\n`filter(source!=target)` to filter out user sent to send himself\n\n`filter(Weight > 1)` dont want to include send 1 time only, only keep 2 time and above\n:::\n\nGetting the graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGAStech_graph <- tbl_graph(nodes = GAStech_nodes,\n                           edges = GAStech_edges_aggregated, \n                           directed = TRUE)\n\nGAStech_graph\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tbl_graph: 54 nodes and 1372 edges\n#\n# A directed multigraph with 1 component\n#\n# Node Data: 54 × 4 (active)\n      id label               Department     Title                               \n   <dbl> <chr>               <chr>          <chr>                               \n 1     1 Mat.Bramar          Administration Assistant to CEO                    \n 2     2 Anda.Ribera         Administration Assistant to CFO                    \n 3     3 Rachel.Pantanal     Administration Assistant to CIO                    \n 4     4 Linda.Lagos         Administration Assistant to COO                    \n 5     5 Ruscella.Mies.Haber Administration Assistant to Engineering Group Mana…\n 6     6 Carla.Forluniau     Administration Assistant to IT Group Manager       \n 7     7 Cornelia.Lais       Administration Assistant to Security Group Manager \n 8    44 Kanon.Herrero       Security       Badging Office                      \n 9    45 Varja.Lagos         Security       Badging Office                      \n10    46 Stenig.Fusil        Security       Building Control                    \n# ℹ 44 more rows\n#\n# Edge Data: 1,372 × 4\n   from    to Weekday Weight\n  <int> <int> <ord>    <int>\n1     1     2 Sunday       5\n2     1     2 Monday       2\n3     1     2 Tuesday      3\n# ℹ 1,369 more rows\n```\n:::\n:::\n\n\n::: callout-note\n## Note\n\n-   directed refers to direction of the relationship, directed network v.s. non-directed network. In the use case here, email is always with a direction.\n\n-   it is necessary to make sure that the number of nodes and edges matches between the network graph and the original data\n\n-   instead of using the name of the person, the number is used only\n:::\n\nPlotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggraph(GAStech_graph) +\n  geom_edge_link() +\n  geom_node_point()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex08_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\ngeom_edge_arc() provides a curvature while geom_edge_link() gives a straight line\n\n## graph layout\n\nusing igraph layout instead\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout = \"nicely\") +\n  geom_edge_link(aes()) +\n  geom_node_point(aes())\n\ng + theme_graph()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex08_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout = \"kk\") +\n  geom_edge_link(aes()) +\n  geom_node_point(aes())\n\ng + theme_graph()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex08_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## add in color to node\n\nthe code below add in color to node based on department, and increase the size to 3\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout = \"nicely\") + \n  geom_edge_link(aes()) +\n  geom_node_point(aes(colour = Department), \n                  size = 3)\n\ng + theme_graph()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex08_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## modify Edge\n\nthe code below use width to control the thickness of the edge, and adding `scale_edge_width()` to ensure it is propotinoal\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- ggraph(GAStech_graph, \n            layout = \"nicely\") + \n  geom_edge_link(aes(width = Weight), alpha = 0.2) +\n  scale_edge_width(range = c(0.1,5)) +\n  geom_node_point(aes(colour = Department), \n                  size = 3)\n\ng + theme_graph()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex08_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\n## Note\n\nsome edges are darker, with higher overlapping\n:::\n\n## Facet\n\nsimilar to ggplot, it can use facet, there are 3 types: graph, edge, and node\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset_graph_style()\ng <- ggraph(GAStech_graph, \n            layout = \"nicely\") + \n  geom_edge_link(aes(width = Weight), alpha = 0.2) +\n  scale_edge_width(range = c(0.1,5)) +\n  geom_node_point(aes(colour = Department), \n                  size = 3)\n\ng + facet_edges(~Weekday)\n```\n\n::: {.cell-output-display}\n![](In-class_Ex08_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nall using he same layout, the location is the same, some appear at certain day, but some are not\n\n## Interactive Visualization\n\nanother library viznetwork is used, the data preparation is different.\n\n-   source, target -\\> from, to, rename the id, using from, to\n",
    "supporting": [
      "In-class_Ex08_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}